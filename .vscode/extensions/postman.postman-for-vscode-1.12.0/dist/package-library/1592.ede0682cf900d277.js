"use strict";(self.webpackChunkpackage_library=self.webpackChunkpackage_library||[]).push([[1592],{1592:(e,a,t)=>{t.d(a,{Z:()=>$e});var n=t(540),i=t.n(n),r=t(9530),o=t.n(r),s=t(7838),l=t(9245),c=t(9578),d=t(6246),u=t(8053),p=t(8560),g=t(9437),m=t(3622),h=t(429),v=t(8022),y=t(5869),k=t(4583),x=t(6880),b=t(1327),f=t(2322);const j=({searchValue:e,onSearch:a})=>{const t=e=>{a(e)};return(0,f.jsx)(b.Z,{type:"search",placeholder:"Find packages...",value:e,onChange:e=>t(e.target.value),onClear:()=>{t("")}})};var C=t(4962),w=t(5736),_=t(6189),I=t(6669);const Z=o()(p.Z).withConfig({displayName:"user-avatar__AvatarItemContainer",componentId:"sc-1uidpfc-0"})(["*:not(:last-child){margin-right:var(--spacing-xs);}"]),S=o()(w.Z).withConfig({displayName:"user-avatar__StyledSpinner",componentId:"sc-1uidpfc-1"})(["margin-left:var(--spacing-xs);"]),P=({userId:e})=>{const{data:a,isLoading:t}=(0,I.usePublicProfile)({userIds:[String(e)],type:"user"}),{data:n}=(0,I.useTeamsByUserId)(),i=(0,I.isUserPartner)(String(e),null==n?void 0:n.organizations[0]),r=null==a?void 0:a[e];return(0,f.jsxs)(Z,{alignItems:"center",gap:"spacing-s","data-testid":"avatar-container",children:[(0,f.jsx)(_.Z,{size:"xs",type:"user",src:null==r?void 0:r.profile_pic_url,tooltip:null==r?void 0:r.name,alt:null==r?void 0:r.name,userId:Number(e),isPartner:i}),t?(0,f.jsx)(S,{}):(0,f.jsx)(m.ZP,{"data-testid":"user-name",isTruncated:!0,color:"content-color-secondary",children:null==r?void 0:r.name})]})},E=o().div.withConfig({displayName:"package-list-item__PackageListItem",componentId:"sc-yszomg-0"})(["padding:var(--spacing-l);border-top:var(--border-width-default) var(--border-style-solid) var(--border-color-default);&:last-child{border-bottom:var(--border-width-default) var(--border-style-solid) var(--border-color-default);}&:hover{background:",";cursor:pointer;}",""],(({selected:e})=>e?"var(--highlight-background-color-secondary)":"var(--background-color-secondary)"),(({selected:e})=>e&&"\n      background: var(--highlight-background-color-secondary);\n    ")),N=o()(p.Z).withConfig({displayName:"package-list-item__StyledSubComponent",componentId:"sc-yszomg-1"})(["margin-top:var(--spacing-xs);"]),D=o().div.withConfig({displayName:"package-list-item__StyledSummaryTextContainer",componentId:"sc-yszomg-2"})(["& > :last-child{margin-bottom:var(--spacing-xs);}"]),L=({isNew:e=!1,isNewInCreation:a,isSelected:t,onPackageSelection:n,packageItem:r,onCancelClick:o})=>{var s;return(0,f.jsx)(E,{selected:t,"data-testid":"package-library-list-item",onClick:async()=>{if(!e){if(a){const e=d.Modals.getModals(),a=["Discard to continue","Back to Package"],t=await e.showWarningDialog({uid:"new-package-discard",subject:"Discard this package?",message:"You are in the process of creating a package. Your progress will be lost if you proceed.",options:[{title:a[0],isDefaultOnDismiss:!0},{title:a[1],isPrimary:!0}]});if((null==t?void 0:t.title)===a[1])return;(null==t?void 0:t.title)===a[0]&&o()}r&&n(r.id)}},children:(0,f.jsxs)(p.Z,{direction:"column",gap:"spacing-xs",children:[(0,f.jsx)(C.Z,{type:"h4",text:e?"New package":null==r?void 0:r.name,isTruncated:!0}),!e&&r&&(0,f.jsxs)(i().Fragment,{children:[0!==(null==(s=r.description)?void 0:s.length)&&(0,f.jsx)(D,{children:(0,f.jsx)(m.ZP,{type:"body-medium",color:"content-color-secondary",maxLines:3,children:r.description})}),(0,f.jsx)(N,{alignItems:"center",children:(0,f.jsx)(P,{userId:r.createdBy})})]})]})},e||null==r?void 0:r.id)};var T=t(1397),A=t(5477),z=t(37);const B="https://go.pstmn.io/package-library",M=/^[a-z]/,O=/^[a-z0-9_-]*$/,V=()=>(0,f.jsxs)(p.Z,{alignItems:"center",gap:"spacing-s",children:[(0,f.jsx)(C.Z,{type:"h4",text:"Package Library"}),(0,f.jsxs)(p.Z,{gap:"spacing-xs",alignItems:"center",children:[(0,f.jsx)(T.Z,{content:"All team members have access to packages in the library",placement:"bottom",openDelay:1e3,children:(0,f.jsx)(A.Z,{"data-testid":"icon-descriptive-team-small"})}),(0,f.jsx)(l.Link,{type:"tertiary",to:B,target:"_blank",rel:"noopener noreferer","data-testid":"package-library-help-icon",children:(0,f.jsx)(h.Z,{type:"tertiary",icon:(0,f.jsx)(z.Z,{}),tooltip:(0,f.jsx)(T.Z,{content:"Learn more about packages",placement:"bottom",openDelay:1e3})})})]})]});var F=t(7560),W=t(2372),U=t(4250),q=t(856),$=t(4867);function R(e,a){const t=null==e||null==e.replace?void 0:e.replace(/[^\w !$%&'()*,./:=?{|}~-]/g,"");return null==t||null==t.replace?void 0:t.replace(/{{([^}]+)}}/g,((e,t)=>void 0===(null==a?void 0:a[t])?"":a[t]))}const H=o().div.withConfig({displayName:"config-template-renderer__CustomPopoverTriggerContainer",componentId:"sc-anyfjt-0"})(["user-select:none;cursor:pointer;"]);function G(e,a){return"object"!=typeof e?null:(0,f.jsx)(m.ZP,{type:null==e?void 0:e.variation,color:null==e?void 0:e.color,isExternal:null==e?void 0:e.isExternal,children:R(null==e?void 0:e.value,a)})}function K(e,a){return"object"!=typeof e?null:(0,f.jsx)(W.Z,{text:R(null==e?void 0:e.value,a),color:null==e?void 0:e.color})}function Y(e,a,t,n){if(!e)return null;if(Array.isArray(e))return e.map((e=>Y(e,a,t,n)));switch(null==e?void 0:e.type){case"text":return Array.isArray(e.value)?(0,f.jsx)(m.ZP,{color:null==e?void 0:e.color,isExternal:null==e?void 0:e.isExternal,type:null==e?void 0:e.variation,children:e.value.map((e=>Y(e,a,t,n)))}):G(e,a);case"link":return function(e,a,t){return"object"!=typeof e?null:(0,f.jsx)(l.Link,{target:(null==e?void 0:e.target)||"_blank",to:R(null==e?void 0:e.to,a),onClick:()=>null==t?void 0:t(e),children:G(e,a)})}(e,a,n);case"heading":return function(e,a){return"object"!=typeof e?null:(0,f.jsx)(C.Z,{type:null==e?void 0:e.variation,text:R(null==e?void 0:e.value,a)})}(e,a);case"button":return function(e,a,t){return"object"!=typeof e?null:(0,f.jsx)(h.Z,{type:e.variation,text:R(null==e?void 0:e.value,a),onClick:()=>null==t?void 0:t(null==e?void 0:e.action)})}(e,a,t);case"tag":return K(e,a);default:return null}}function Q({config:e,variables:a,trigger:t,onButtonClick:i,onLinkClick:r}){const[o,s]=(0,n.useState)(!1);function l(){s((e=>!e))}const c=(0,f.jsx)(h.Z,{type:(null==e?void 0:e.closeButtonType)||"secondary",text:"Close",onClick:l});if(!e||"object"!=typeof e||!(0,u.isValidConfig)(e))return null;switch(null==e?void 0:e.type){case"banner":return(0,f.jsx)(U.Z,{hideIcon:null==e?void 0:e.hideIcon,status:null==e?void 0:e.status,title:R(null==e?void 0:e.title,a),children:Y(null==e?void 0:e.value,a,i,r)});case"text":return(0,f.jsxs)(p.Z,{gap:"spacing-s",width:"100%",children:[!e.hideIcon&&(0,f.jsx)($.Z,{color:null==e?void 0:e.color}),(0,f.jsx)(m.ZP,{color:null==e?void 0:e.color,isExternal:null==e?void 0:e.isExternal,type:null==e?void 0:e.variation,children:Y(null==e?void 0:e.value,a,i,r)})]});case"popover":return(0,f.jsx)(q.ZP,(0,F.Z)({},null!=e&&e.hasCloseButton?{isOpen:o}:{},{padding:"spacing-l",pointer:"true",placement:"bottom",triggerEvent:(null==e?void 0:e.triggerEvent)||"mouseenter",trigger:null!=e&&e.trigger?(0,f.jsx)(H,{onClick:l,children:Y(null==e?void 0:e.trigger,a,i,r)}):t,children:(0,f.jsxs)(p.Z,{direction:"column",gap:"spacing-l",children:[(0,f.jsx)(p.Z,{direction:"column",gap:"spacing-s",children:Y(null==e?void 0:e.value,a,i,r)}),((null==e?void 0:e.actions)||(null==e?void 0:e.hasCloseButton))&&(0,f.jsxs)(p.Z,{gap:"spacing-s",children:[(null==e?void 0:e.hasCloseButton)&&"actions-start"===(null==e?void 0:e.closeButtonPlacement)&&c,(null==e?void 0:e.actions)&&Y(null==e?void 0:e.actions,a,i,r),(null==e?void 0:e.hasCloseButton)&&"actions-end"===(null==e?void 0:e.closeButtonPlacement)&&c]})]})}));case"tag":return K(e,a);default:return null}}const X=o()(p.Z).withConfig({displayName:"package-list__PackageListContainer",componentId:"sc-18h290z-0"})(["height:100%;width:100%;"]),J=o()(p.Z).withConfig({displayName:"package-list__PackageList",componentId:"sc-18h290z-1"})(["overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none;&::-webkit-scrollbar{display:none;}"]),ee=o().div.withConfig({displayName:"package-list__SkeletonLoaderItem",componentId:"sc-18h290z-2"})(["height:100px;border-radius:var(--border-radius-default);background-color:var(--background-color-tertiary);animation:fade 1s linear infinite;width:100%;"]),ae=o().div.withConfig({displayName:"package-list__SkeletonLoader",componentId:"sc-18h290z-3"})(["margin-top:var(--spacing-m);display:flex;flex-direction:column;gap:var(--spacing-m);width:100%;"]),te=({isNewInCreation:e,selectedPackageId:a,onPackageSelection:t,onCreateClick:i,onCancelClick:r,packages:o,isLoadingPackages:s})=>{const[c,d]=(0,n.useState)(""),b=(0,k.useDebounce)(c),{planLimitMessageConfig:C,configTemplateVariables:w,isHardLimitReached:_,createNewPackageButtonTooltip:I}=(0,u.usePlanUsageData)(),Z=null!=o&&o.length?(0,f.jsx)(J,{direction:"column",grow:1,shrink:1,children:(()=>{var n;let i=o;return b&&(i=null==o?void 0:o.filter((e=>e.name.toLowerCase().includes(b.toLowerCase())))),(0,f.jsxs)(f.Fragment,{children:[e&&(0,f.jsx)(L,{isNew:!0,isSelected:!0,onPackageSelection:t,onCancelClick:r}),null==(n=i)?void 0:n.map((n=>(0,f.jsx)(L,{isNewInCreation:e,isSelected:a===n.id,packageItem:n,onPackageSelection:t,onCancelClick:r},n.id)))]})})()}):(0,f.jsx)(p.Z,{children:(0,f.jsx)(g.Z,{title:"No packages in this team yet!",description:(0,f.jsxs)(m.ZP,{type:"para",children:["Packages help your team reuse common scripts.Â ",(0,f.jsx)(l.Link,{type:"plain",to:B,target:"_blank",children:(0,f.jsx)(m.ZP,{type:"link-default",children:"Learn more."})})]}),secondaryAction:(0,f.jsx)(h.Z,{type:"primary",size:"medium",onClick:()=>{x.AnalyticsService.addEventV2({category:"package_library",action:"initiate_package_creation",label:"create_package_button",variantId:"ide"}),i()},text:"Create Package","data-testid":"package-library__new-button"}),children:(0,f.jsx)(v.Z,{})})});return(0,f.jsxs)(X,{direction:"column",gap:"spacing-s",padding:"spacing-s spacing-m spacing-m spacing-s",children:[(0,f.jsxs)(p.Z,{alignItems:"center",justifyContent:"space-between",children:[(0,f.jsx)(V,{}),(0,f.jsx)(h.Z,{type:"tertiary",size:"medium",iconType:y.Z,text:"New Package",onClick:()=>{x.AnalyticsService.addEventV2({category:"package_library",action:"initiate_package_creation",label:"package_library_plus",variantId:"ide"}),i()},icon:(0,f.jsx)(y.Z,{}),"data-testid":"package-library__new-button",isDisabled:_,tooltip:R(I,w)})]}),C&&(0,f.jsx)(p.Z,{shrink:1,"data-testid":"package-usage-limit-message",children:(0,f.jsx)(Q,{config:C,variables:w})}),(0,f.jsx)(j,{searchValue:c,onSearch:d}),s?(0,f.jsx)(ae,{children:Array.from({length:25}).map(((e,a)=>(0,f.jsx)(ee,{},a)))}):Z]})};var ne=t(2135),ie=t(1466),re=t(1590),oe=t(99);const se=o()(p.Z).withConfig({displayName:"package-library-empty-content__CodeBlock",componentId:"sc-m5cijv-0"})(["margin-left:var(--spacing-m);line-height:var(--line-height-m);pre{margin:0;padding:var(--spacing-s);}"]),le=[{title:"1. Create a package with some reusable code.",snippet:"function add(a, b) {\n   return a + b;\n};"},{title:"2. Export the functions you want to reuse.",snippet:"module.exports = {add};"},{title:(0,f.jsxs)(f.Fragment,{children:["3. Use pm.require to use this package in your request,",(0,f.jsx)("br",{}),"Â Â Â Â folder and collection scripts."]}),snippet:'const myScript = pm.require("package");\nmyScript.add();'}],ce=()=>(0,f.jsx)(p.Z,{alignItems:"center",justifyContent:"center",grow:1,shrink:1,height:"100%",minWidth:"fit-content",children:(0,f.jsx)(p.Z,{direction:"column",gap:"spacing-xl",children:le.map(((e,a)=>(0,f.jsxs)(p.Z,{direction:"column",gap:"spacing-s",justifyContent:"center",alignItems:"flex-start",children:[(0,f.jsx)(p.Z,{children:(0,f.jsx)(m.ZP,{children:e.title})}),(0,f.jsx)(se,{children:(0,f.jsx)(m.ZP,{type:"code",children:(0,f.jsx)("pre",{children:e.snippet})})})]},a)))})});var de=t(4591);const ue=o()(b.Z).withConfig({displayName:"header-name__StyledTextNameArea",componentId:"sc-5xugud-0"})(["height:24px;padding-left:2px;&:hover{background-color:var(--background-color-secondary);}&:focus-within{background-color:var(--background-color-primary);}input{font-weight:",";font-size:14px;}box-shadow:",";"],(({value:e})=>""===e?"var(--text-weight-regular)":"var(--text-weight-bold)"),(({isEditing:e})=>e?"0 0 0 1px var(--request-url-highlight-border-color)":"none")),pe=o()(C.Z).withConfig({displayName:"header-name__StyledHeading",componentId:"sc-5xugud-1"})(["&:hover{cursor:text;background-color:var(--background-color-secondary);}border-radius:var(--border-radius-s);line-height:22px;font-size:14px;"]),ge=o()(p.Z).withConfig({displayName:"header-name__PacakgeNameNote",componentId:"sc-5xugud-2"})(["margin-top:4px;position:relative;"]),me=o().div.withConfig({displayName:"header-name__StyledSkeletonParent",componentId:"sc-5xugud-3"})(["width:45%;"]);function he({onChange:e,packageItem:a,autofocus:t,validationErrors:r}){const[o,s]=(0,n.useState)(t);return o||r.name||!a.name?(0,f.jsxs)(i().Fragment,{children:[(0,f.jsx)(ue,{value:a.name,onChange:({target:{value:a}})=>{e("name",a)},width:"45%",autoFocus:t,placeholder:"package-name",validationStatus:r.name?"error":null,validationMessage:r.name,onBlur:()=>{s(!1)},onFocus:()=>s(!0),isEditing:o,size:"small","data-testid":"package-library-content__name-input"}),!r.name&&o&&(0,f.jsxs)(ge,{gap:"spacing-xs",justifyContent:"flex-start",alignItems:"center",children:[(0,f.jsx)(de.Z,{color:"content-color-secondary"}),(0,f.jsx)(m.ZP,{type:"small",children:"Name cannot be changed after package creation"})]})]}):(0,f.jsx)(me,{onClick:()=>{s(!0)},children:(0,f.jsx)(pe,{type:"h4",text:a.name,isTruncated:!0})})}var ve=t(7110);const ye=o()(b.Z).withConfig({displayName:"header-summary__StyledTextArea",componentId:"sc-vbeje-0"})(["box-shadow:",";padding:0;height:18px;width:65%;&:hover{background-color:var(--background-color-secondary);}font-size:var(--text-size-s);&&&{color:var(--content-color-secondary);border:none;margin:none;}"],(({isEditing:e})=>e?"0 0 0 1px var(--request-url-highlight-border-color)":"none")),ke=o().div.withConfig({displayName:"header-summary__StyledSkeletonParent",componentId:"sc-vbeje-1"})(["&:hover{cursor:text;background-color:var(--background-color-secondary);}width:65%;line-height:22px;font-size:var(--text-size-xl);text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),xe=o().div.withConfig({displayName:"header-summary__StyledWrapper",componentId:"sc-vbeje-2"})(["margin-top:var(--spacing-xs);"]);function be({onChange:e,packageItem:a,validationErrors:t}){const[i,r]=(0,n.useState)(!1);return(0,f.jsx)(xe,{children:i?(0,f.jsx)(ye,{placeholder:"Add a summary",value:a.description,onChange:({target:{value:a}})=>e("description",a),label:(0,f.jsx)(ve.Z,{}),validationStatus:t.description?"error":null,validationMessage:t.description,onBlur:()=>r(!1),autoFocus:!0,isEditing:i,size:"small","data-testid":"package-library-content__summary-input"}):(0,f.jsx)(ke,{onFocus:()=>{r(!0)},tabIndex:0,"data-testid":"package-library-content__summary-input",children:(0,f.jsx)(m.ZP,{color:a.description?"content-color-secondary":"content-color-tertiary",children:a.description||"Add a summary"})})})}const fe=o()(p.Z).withConfig({displayName:"new-package-header__PackageDescriptionHeader",componentId:"sc-ak6vt3-0"})(["width:100%;padding:var(--spacing-l);border-bottom:var(--border-width-default) var(--border-style-solid) var(--border-color-default);"]),je=o()(h.Z).withConfig({displayName:"new-package-header__StyledButton",componentId:"sc-ak6vt3-1"})([":disabled{background-color:var(--button-primary-background-color) !important;color:var(--button-primary-content-color) !important;opacity:0.5;}"]),Ce=({packageItem:e,onChange:a,onSave:t,onCancel:n,isSaving:i,validationErrors:r,isDisabled:o})=>(0,f.jsxs)(fe,{gap:"spacing-m",children:[(0,f.jsxs)(p.Z,{direction:"column",grow:1,shrink:1,minWidth:"0px",children:[(0,f.jsx)(he,{packageItem:e,onChange:a,validationErrors:r,autofocus:!0}),(0,f.jsx)(be,{packageItem:e,onChange:a,validationErrors:r})]}),(0,f.jsxs)(p.Z,{gap:"spacing-m",children:[(0,f.jsx)(je,{type:"primary",isLoading:i,text:"Create","data-testid":"package-library-content__create-button",onClick:t,isDisabled:o}),(0,f.jsx)(h.Z,{type:"secondary",text:"Cancel",onClick:n,"data-testid":"package-library-content__cancel-button"})]})]});var we=t(4079),_e=t(4691),Ie=t(8263),Ze=t(9824),Se=t(7282),Pe=t(4502),Ee=t(9225),Ne=t(4350),De=t(3101);const Le=({packageItem:e,onChange:a,onSave:t,onDelete:n,isSaving:i,validationErrors:r,isSaveDisabled:o})=>{var s;const l=(0,De.getUserId)(),{data:c}=(0,Ne.useEntityPermissions)(e.id+l,{checks:{canDeletePackage:{entityType:"user",entityId:l,permission:"DELETE_PACKAGE",objectType:"package",objectId:e.id}}}),d=null==c||null==(s=c.results)||null==(s=s.canDeletePackage)?void 0:s.allowed;return(0,f.jsx)(p.Z,{justifyContent:"space-between",alignItems:"center",children:(0,f.jsxs)(fe,{gap:"spacing-m",grow:1,children:[(0,f.jsxs)(p.Z,{direction:"column",gap:"spacing-xs",grow:1,shrink:1,minWidth:"0px",children:[(0,f.jsx)(p.Z,{width:"45%",children:(0,f.jsx)(C.Z,{type:"h4",text:e.name,isTruncated:!0})}),(0,f.jsx)(be,{packageItem:e,onChange:a,validationErrors:r})]}),(0,f.jsxs)(p.Z,{gap:"spacing-s",alignItems:"flex-start",children:[(0,f.jsx)(we.Z,{children:(0,f.jsx)(h.Z,{type:"tertiary",isLoading:i,"data-testid":"package-library-content__save-button",icon:(0,f.jsx)(Pe.Z,{}),text:"Save",isDisabled:o,onClick:t})}),(0,f.jsxs)(_e.Z,{children:[(0,f.jsx)(Ie.Z,{children:(0,f.jsx)(h.Z,{icon:(0,f.jsx)(Ee.Z,{}),type:"tertiary","data-testid":"package-library-content__actions"})}),(0,f.jsx)(Ze.Z,{placement:"bottom-end",children:(0,f.jsx)(Se.Z,{isDisabled:!d,"data-testid":"package-library-content__delete-button",type:"destructive",onClick:n,children:"Delete"})})]})]})]})})},Te=["jsLib","node","postman-collection","chai","pre-script"];var Ae=t(7201);const ze=(0,n.lazy)((0,re.loadRemoteModule)("code-editor/CodeEditor")),Be=i().forwardRef(((e,a)=>(0,f.jsx)(n.Suspense,{fallback:(0,f.jsx)(w.Z,{}),children:(0,f.jsx)(ze,(0,F.Z)({},e,{ref:a}))}))),Me=o().div.withConfig({displayName:"package-library-content__EditorContainer",componentId:"sc-favmxv-0"})(["width:100%;height:100%;flex:1;overflow-y:auto;"]),Oe=o()(p.Z).withConfig({displayName:"package-library-content__BlankStateWrapper",componentId:"sc-favmxv-1"})(["overflow:hidden;"]),Ve=(0,n.forwardRef)((({packages:e,selectedPackage:a,isNew:t,setIsNew:i,setSelectedPackageId:r,setIsDirty:o,onCancelClick:s,isLoadingPackageLibrary:l,setIsLoadingPackageLibrary:m},v)=>{var y,k,b,j,C;const _=(0,oe.useActiveWorkspaceId)(),{addToast:I}=c.Toast.getToasts(),Z=d.Modals.getModals(),{mutate:S,isLoading:P}=(0,u.useCreatePackage)(),{mutateAsync:E,isLoading:N}=(0,u.useUpdatePackage)(),{mutateAsync:D,isLoading:L}=(0,u.useUpdateScript)(),{mutate:T}=(0,u.useDeletePackage)(),{data:A,isLoading:z,fetchStatus:B,isError:V,refetch:W}=(0,u.useScript)({packageId:null==a?void 0:a.id,scriptId:null==a||null==(y=a.indexScript)?void 0:y.id}),[U,q]=(0,n.useState)(null),$=P||N||L,R=t||!z&&(null==U?void 0:U.id)===(null==a?void 0:a.id)&&(null==U||null==(k=U.script)?void 0:k.id)===(null==a||null==(b=a.indexScript)?void 0:b.id),H={script:!!R&&void 0!==(null==U?void 0:U.script.sourceCode)&&(null==A||null==(j=A.contents)?void 0:j.src)!==(null==U?void 0:U.script.sourceCode),description:!!R&&(null==U?void 0:U.description)!==(null==a?void 0:a.description)},G=H.script||H.description,K=$?{name:"",description:""}:function({packages:e,packageItem:a,isNew:t=!1}){var n;if(!a)return{};const i={};return null!=a&&a.name&&(M.test(a.name)?O.test(a.name)?0===a.name.trim().length?i.name="Package name cannot be empty.":a.name.length>200?i.name="Package name cannot be more than 200 characters.":t&&e.find((e=>e.name===a.name))&&(i.name=`A package with ${a.name} already exists in your team.`):i.name="Package name must only contain lowercase alphabets, digits, hyphens (-), or underscores (_).":i.name="Package name must start with a lowercase alphabet."),(null==a||null==(n=a.description)?void 0:n.length)>140&&(i.description="Summary can't exceed 140 characters."),i}({packages:e||[],packageItem:U,isNew:t}),Y=Object.keys(K||{}).length>0,Q=e=>{I({status:"error",description:e})},X=(e,a)=>{q((t=>(0,F.Z)({},t,{[e]:a})))},J=(e,a)=>D({packageId:e,scriptId:a,patches:[{op:"replace",path:"/contents/src",value:null==U?void 0:U.script.sourceCode}]},{onError:()=>{Q("Error saving the script. Please try again")}}),ee=async()=>{if(t)return void(null!=U&&U.name?S({workspaceId:_,requestBody:{name:null==U?void 0:U.name,description:null==U?void 0:U.description}},{onError:e=>{const a=e.body.detail||"Error creating the package. Please try again.";Q(a)},onSuccess:e=>{i(!1);const{id:a,indexScript:t}=e.data;var n,o;n=a,o=t.id,q((e=>(0,F.Z)({},e,{id:n,script:(0,F.Z)({},null==e?void 0:e.script,{id:o})}))),r(n),x.AnalyticsService.addEventV2({category:"package_library",action:"create_new_package",entityType:"package",entityId:a,variantId:"ide"}),(0,Ae.updateCache)({key:(0,u.getScriptQuery)(null==e?void 0:e.data.id,null==e?void 0:e.data.indexScript.id).queryKey,updater:()=>({id:t.id,contents:{src:null==U?void 0:U.script.sourceCode},createdAt:(new Date).toISOString(),lastRetrievedAt:(new Date).toISOString()})}),H.script&&J(a,t.id)}}):I({status:"error",description:"Package name cannot be empty."}));const e=[];H.description&&e.push(E({packageId:null==U?void 0:U.id,patches:[{op:"replace",path:"/description",value:null==U?void 0:U.description}]},{onError:()=>{Q("Error updating the package. Please try again.")},onSettled:()=>{x.AnalyticsService.addEventV2({category:"package_library",action:"update_existing_package",entityType:"package",entityId:null==U?void 0:U.id,variantId:"ide"})}})),H.script&&e.push(J(null==U?void 0:U.id,null==a?void 0:a.indexScript.id)),await Promise.all(e)};return(0,n.useImperativeHandle)(v,(()=>({handleSave:ee}))),(0,n.useEffect)((()=>{z||m(!1)}),[z]),(0,n.useEffect)((()=>{if(t)q({id:"",name:"",description:"",script:{sourceCode:"// Use module.exports to export the functions that should be\n// available to use from this package.\n// module.exports = { <your_function> }\n\n// Once exported, use this statement in your scripts to use the package.\n// const myPackage = pm.require('<package_name>')"}});else if(a){const{id:e,name:t,description:n,indexScript:i}=a;q((a=>{var r;return{id:e,name:t,description:n,script:(0,F.Z)({},i,{sourceCode:a&&a.id===e?null==(r=a.script)?void 0:r.sourceCode:void 0})}}))}else q(null)}),[t,a]),(0,n.useEffect)((()=>{var e;!z&&null!=A&&null!=(e=A.contents)&&e.src&&a&&q((e=>(0,F.Z)({},e,{script:{id:a.indexScript.id,sourceCode:A.contents.src}})))}),[z,null==A||null==(C=A.contents)?void 0:C.src,a]),(0,n.useEffect)((()=>{o(G)}),[G]),!t&&z&&"fetching"===B||l?(0,f.jsx)(p.Z,{justifyContent:"center",height:"100%",children:(0,f.jsx)(w.Z,{})}):V?(0,f.jsx)(Oe,{direction:"column",height:"100%",justifyContent:"center",alignItems:"center",children:(0,f.jsx)(g.Z,{title:"Unable to load this package",description:"Try refreshing or check back in some time.",primaryAction:(0,f.jsx)(h.Z,{type:"primary",text:"Refresh",onClick:W}),children:(0,f.jsx)(ne.Z,{})})}):U?(0,f.jsxs)(f.Fragment,{children:[t?(0,f.jsx)(Ce,{packageItem:U,isSaving:$,validationErrors:K,isDisabled:Y,onChange:X,onSave:ee,onCancel:s}):(0,f.jsx)(Le,{packageItem:U,isSaving:$,validationErrors:K,isSaveDisabled:!G||Y,onChange:X,onSave:ee,onDelete:async()=>{x.AnalyticsService.addEventV2({category:"package_library",action:"initiate_delete_package",entityType:"package",entityId:null==U?void 0:U.id,variantId:"ide"}),await(async()=>await ie.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"SHOW_INPUT_BOX",payload:{title:`Delete "${null==U?void 0:U.name}"`,ignoreFocusOut:!0,prompt:`To confirm, type package name "${null==U?void 0:U.name}" above`}})===(null==U?void 0:U.name)||(I({status:"error",description:"Package name does not match. Please try again."}),!1))()&&await(async()=>{const e=await Z.showWarningDialog({uid:"package-library-delete-package",subject:`Delete ${null==U?void 0:U.name}?`,message:"Are you sure you want to permanently delete the package?",options:[{title:"Cancel",isDefaultOnDismiss:!0},{title:"Delete",isPrimary:!0}]});return"Delete"===(null==e?void 0:e.title)})()&&T({packageId:null==U?void 0:U.id},{onError:()=>{Q("Error deleting the package. Please try again")},onSettled:e=>{r(null),x.AnalyticsService.addEventV2({category:"package_library",action:"confirm_delete_package",entityType:"package",entityId:null==U?void 0:U.id,variantId:"ide"})}})}}),(0,f.jsx)(Me,{"data-testid":"package-library-content__script-editor",children:(0,f.jsx)(Be,{hideActionBar:!0,typeDefinitionTypes:[...Te],onChange:e=>{q((a=>(0,F.Z)({},a,{script:(0,F.Z)({},null==a?void 0:a.script,{sourceCode:e})})))},value:null==U?void 0:U.script.sourceCode,readOnly:$,language:"javascript"})})]}):(0,f.jsx)(ce,{})})),Fe=o().div.withConfig({displayName:"package-library__PackageManagerContainer",componentId:"sc-180rtsj-0"})(["height:100vh;"]),We=o()(c.PaneGroup).withConfig({displayName:"package-library__StyledPaneGroup",componentId:"sc-180rtsj-1"})(["height:100%;"]),Ue=o()(c.PaneContent).withConfig({displayName:"package-library__StyledPaneContent",componentId:"sc-180rtsj-2"})(["height:100%;"]),qe=()=>{const{setTabTitle:e}=(0,l.useTabTitleMeta)(),a=d.Modals.getModals(),[t,i]=(0,n.useState)(!0),[r,o]=(0,n.useState)(!1),[s,p]=(0,n.useState)(!1),[g,m]=(0,n.useState)(null),h=(0,n.useRef)(null),{data:v,isLoading:y,isError:k}=(0,u.usePackages)({isDeleted:!1}),x=(0,n.useMemo)((()=>g&&v&&v.find((e=>e.id===g))||null),[v,g]),b=async()=>{const e="Discard Changes",t="Save Changes",n=await a.showWarningDialog({uid:"package-library-unsaved-changes-package",subject:`Save changes to "${null==x?void 0:x.name}"?`,message:`There are some unsaved changes in the current package "${null==x?void 0:x.name}" which will be lost if you proceed.`,options:[{title:e,isDefaultOnDismiss:!0},{title:"Cancel"},{title:t,isPrimary:!0}]});return(null==n?void 0:n.title)===e||(null==n?void 0:n.title)===t&&(await(null==(i=h.current)||null==i.handleSave?void 0:i.handleSave()),!0);var i},j=()=>{var e;o(!1),p(!1);const a=v?null==(e=v[0])?void 0:e.id:null;m(a)};return(0,n.useEffect)((()=>{y||!k&&0!==v.length||i(!1)}),[y,k]),(0,n.useEffect)((()=>{v&&v.length>0&&!g&&!r&&m(v[0].id)}),[v,g]),(0,n.useEffect)((()=>{e("Package Library","package-library",{isDirty:s})}),[s]),(0,f.jsx)(Fe,{children:(0,f.jsxs)(We,{defaultLayout:"horizontal",children:[(0,f.jsx)(c.Pane,{width:{min:300,max:400},children:(0,f.jsx)(Ue,{children:(0,f.jsx)(te,{packages:v,isLoadingPackages:y,selectedPackageId:r?null:g,isNewInCreation:r,onCancelClick:j,onPackageSelection:async e=>{if(e!==g){if(s&&!r&&!await b())return;m(e)}},onCreateClick:async()=>{if(!r){if(s&&!await b())return;t&&i(!1),o(!0),m(null)}}})})}),(0,f.jsx)(c.Pane,{children:(0,f.jsx)(Ue,{children:(0,f.jsx)(Ve,{ref:h,packages:v,isNew:r,setIsNew:o,selectedPackage:x,setSelectedPackageId:m,setIsDirty:p,onCancelClick:j,setIsLoadingPackageLibrary:i,isLoadingPackageLibrary:t})})})]})})},$e=function(){return(0,f.jsx)(s.VW,{children:(0,f.jsx)(qe,{})})}}}]);
//# sourceMappingURL=1592.ede0682cf900d277.js.map